import{d as M,r as _,a as g,c as a,n as F,j as l,g as t,_ as b,b as u,y as k,t as v,w as R,C as A,k as K,F as y,e as S,x as L,p as N,v as E,D as V,o as H,f as T,u as D}from"./index-C41ojl20.js";import{h as w,A as B}from"./api-DUXCY34Q.js";import{L as U}from"./ListButton-uHzKahKN.js";import{u as j}from"./KinopoiskBd.store-Db0CSYUq.js";import{I as O}from"./IconBackArrow-Bs36Jw_s.js";const P=M("localDB",()=>{const p=_();async function r(){const{data:i}=await w.get(B.local_db);p.value=i}return{local_db:p,fetchLocalDB:r}}),q=g({__name:"IconAddRecord",props:{size:{}},setup(p){return(r,i)=>(t(),a("svg",{class:"add-record",style:F(`width:${r.size}px; height:${r.size}px;`),x:"0px",y:"0px",viewBox:"0 0 122.88 119.72","xml:space":"preserve"},i[0]||(i[0]=[l("g",null,[l("path",{d:"M22.72,0h77.45c6.25,0,11.93,2.56,16.05,6.67c4.11,4.11,6.67,9.79,6.67,16.05v74.29c0,6.25-2.56,11.93-6.67,16.05 l-0.32,0.29c-4.09,3.94-9.64,6.38-15.73,6.38H22.72c-6.25,0-11.93-2.56-16.05-6.67l-0.3-0.32C2.43,108.64,0,103.09,0,97.01V22.71 c0-6.25,2.55-11.93,6.67-16.05C10.78,2.55,16.46,0,22.72,0L22.72,0z M55.47,38.34c0-3.3,2.67-5.97,5.97-5.97 c3.3,0,5.97,2.67,5.97,5.97v15.55h15.55c3.3,0,5.97,2.67,5.97,5.97c0,3.3-2.67,5.97-5.97,5.97H67.41v15.55 c0,3.3-2.67,5.97-5.97,5.97c-3.3,0-5.97-2.67-5.97-5.97V65.83H39.91c-3.3,0-5.97-2.67-5.97-5.97c0-3.3,2.67-5.97,5.97-5.97h15.55 V38.34L55.47,38.34z M100.16,10.24H22.72c-3.43,0-6.54,1.41-8.81,3.67c-2.26,2.26-3.67,5.38-3.67,8.81v74.29 c0,3.33,1.31,6.35,3.43,8.59l0.24,0.22c2.26,2.26,5.38,3.67,8.81,3.67h77.45c3.32,0,6.35-1.31,8.59-3.44l0.21-0.23 c2.26-2.26,3.67-5.38,3.67-8.81V22.71c0-3.42-1.41-6.54-3.67-8.81C106.71,11.65,103.59,10.24,100.16,10.24L100.16,10.24z"})],-1)]),4))}}),G=b(q,[["__scopeId","data-v-e9ff9007"]]),J=g({__name:"IconCheck",props:{size:{}},setup(p){return(r,i)=>(t(),a("svg",{class:"check-icon",style:F(`width:${r.size}px; height:${r.size}px;`),x:"0px",y:"0px",viewBox:"0 0 122.88 109.76","xml:space":"preserve"},i[0]||(i[0]=[l("g",null,[l("path",{class:"st0",d:"M0,52.88l22.68-0.3c8.76,5.05,16.6,11.59,23.35,19.86C63.49,43.49,83.55,19.77,105.6,0h17.28 C92.05,34.25,66.89,70.92,46.77,109.76C36.01,86.69,20.96,67.27,0,52.88L0,52.88z"})],-1)]),4))}}),Q=b(J,[["__scopeId","data-v-78a71a62"]]),W={class:"local-db-rec-container"},X={key:0,class:"check"},Y={class:"local-db-record"},Z={class:"local-db-name"},ee=g({__name:"LocalDbListElement",props:{filename:{},file_id:{},kpinfo_id:{}},emits:["clickRecord"],setup(p,{emit:r}){const i=r;return(e,c)=>(t(),a("div",W,[e.kpinfo_id!=null?(t(),a("div",X,[k(Q,{size:15})])):u("",!0),l("div",Y,[l("div",Z,v(e.filename),1),l("div",null,[k(U,{onClick:c[0]||(c[0]=d=>i("clickRecord",e.file_id))},{default:R(()=>[k(G,{size:20})]),_:1})])])]))}}),se=b(ee,[["__scopeId","data-v-fe90f400"]]),oe={class:"local-db-record"},te=g({__name:"BDListElementSimple",props:{name:{},rec_id:{}},emits:["clickKpRecord"],setup(p,{emit:r}){const i=r;return(e,c)=>(t(),a("div",oe,[l("div",{class:"local-db-name",onClick:c[0]||(c[0]=d=>i("clickKpRecord",e.rec_id))},v(e.name),1)]))}}),ae=b(te,[["__scopeId","data-v-3cbae339"]]),ne={key:0,class:"seasons-container"},le=["onClick"],ie={class:"season-header"},ce={class:"episodes-list"},re=["onClick"],de={class:"form-container"},ue={class:"form-header"},pe={class:"form-field"},_e={class:"form-actions"},ve=["disabled"],me=["disabled"],fe=g({__name:"SeasonsSeriesLocalDB",props:{seasons:{}},setup(p){const r=p,i=_(!1),e=A({name:"",type:"",id:0,originalName:""}),c=_({}),d=_(null),m=K(()=>Object.values(c.value).some(s=>s)||d.value!==null),C=(s,n,o)=>{e.type=s,e.id=n,e.name=o,e.originalName=o,c.value={},d.value=null,f()};function $(s){c.value[s]=!0}function f(){i.value=!i.value}function x(s){const n=s.target;n.files&&n.files[0]&&(d.value=n.files[0],$("poster"))}function I(){e.name=e.originalName,c.value={},d.value=null}async function z(){try{const s=new FormData;c.value.name&&s.append("name",e.name),d.value&&s.append("poster",d.value),s.append("rec_id",String(e.id)),s.append("database",e.type);const{data:n}=await w.post(B.local_db_multiseries_update,s,{headers:{"Content-Type":"multipart/form-data"}});console.log(n),f()}catch(s){console.error("Ошибка при отправке данных:",s)}}return(s,n)=>(t(),a(y,null,[i.value?u("",!0):(t(),a("div",ne,[(t(!0),a(y,null,S(r.seasons,o=>(t(),a("div",{key:o.season_id,class:"season-item",onClick:L(h=>C("Seasons",o.season_id,o.season_name),["stop"])},[l("div",ie,[l("h3",null,v(o.season_name),1)]),l("div",ce,[(t(!0),a(y,null,S(o.series,h=>(t(),a("div",{key:h.episode_id,class:"episode-item",onClick:L(we=>C("Series",h.episode_id,h.episode_name),["stop"])},v(h.episode_name),9,re))),128))])],8,le))),128))])),i.value?(t(),a("div",{key:1,class:"form-overlay",onClick:L(f,["self"])},[l("div",de,[l("div",ue," Редактирование "+v(e.type==="Seasons"?"сезона:":"эпизода:")+" "+v(e.name),1),l("form",{onSubmit:L(z,["prevent"]),class:"edit-form"},[l("div",pe,[n[2]||(n[2]=l("label",null,"Название",-1)),N(l("input",{type:"text",id:"name","onUpdate:modelValue":n[0]||(n[0]=o=>e.name=o),onInput:n[1]||(n[1]=o=>$("name")),class:V({changed:c.value.name})},null,34),[[E,e.name]])]),n[3]||(n[3]=l("label",null,"Загрузить постер",-1)),l("input",{type:"file",id:"poster",onChange:x,class:V({changed:c.value.poster})},null,34),l("div",_e,[l("button",{type:"submit",disabled:!m.value},"Сохранить",8,ve),l("button",{type:"button",onClick:I,disabled:!m.value},"Сбросить",8,me),l("button",{type:"button",onClick:f},"Отмена")])],32)])])):u("",!0)],64))}}),he=b(fe,[["__scopeId","data-v-47f86608"]]),ke={key:1},ye={key:0,class:"record-container"},ge=["onClick"],be={key:1,class:"category-name"},Ce={key:2},$e={key:0},Le={key:3},De={key:0},Se=g({__name:"AdminViewLocalDB",setup(p){const r=P(),i=j(),e=_(!0),c=_(!1),d=_(),m=_([]);H(()=>{r.fetchLocalDB()});function C(s){console.log("showListKpinfo",s),i.fetchKpinfo(),e.value=!e.value,d.value=s}function $(){e.value||(e.value=!e.value),c.value&&(m.value=[],c.value=!1)}async function f(s,n){const{data:o}=await w.post(B.local_db,{file_id:s,kpinfo_id:n});console.log(o)}function x(s){console.log("kpID",s),console.log("fileID",d.value),e.value=!e.value,d.value&&f(d.value,s)}async function I(s){const{data:n}=await w.get(B.local_db_multiseries(s));console.log(n),m.value=n}function z(s){I(s),c.value=!0,e.value=!1}return(s,n)=>(t(),a(y,null,[!e.value||c.value?(t(),T(O,{key:0,size:30,onClick:n[0]||(n[0]=o=>$())})):u("",!0),e.value?(t(),a("div",ke,[D(r).local_db?(t(),a("div",ye,[(t(!0),a(y,null,S(D(r).local_db,o=>(t(),a("div",{class:"record-item",key:o.id},[o.category==="Serials"?(t(),a("div",{key:0,class:"category-name",onClick:h=>z(o.id)},v(o.category),9,ge)):(t(),a("div",be,v(o.category),1)),k(se,{kpinfo_id:o.kpinfo_id,filename:o.file_name,file_id:o.id,onClickRecord:C},null,8,["kpinfo_id","filename","file_id"])]))),128))])):u("",!0)])):u("",!0),!e.value&&!c.value?(t(),a("div",Ce,[D(i).kpinfo?(t(),a("div",$e,[(t(!0),a(y,null,S(D(i).kpinfo,o=>(t(),a("div",{key:o.id},[k(ae,{name:o.name,rec_id:o.id,onClickKpRecord:x},null,8,["name","rec_id"])]))),128))])):u("",!0)])):u("",!0),!e.value&&c.value?(t(),a("div",Le,[m.value?(t(),a("div",De,[k(he,{seasons:m.value},null,8,["seasons"])])):u("",!0)])):u("",!0)],64))}}),Fe=b(Se,[["__scopeId","data-v-0be21fb4"]]);export{Fe as default};
